module.exports = function(app){

<<<<<<< HEAD
    var index = require('./controllers/index');
    var passport = require('passport');
    var users = require('./controllers/users');
    var frontend = require('./controllers/frontend')
//    var admin = require('./controllers/admin');
=======
>>>>>>> 321bd1bf31fb74b98cffa4195cc7700d3b6a8d1a


var index = require('./controllers/index');
var passport = require('passport');
var users = require('./controllers/users');
var admin = require('./controllers/admin');

<<<<<<< HEAD
    app.get('/users/', users.list);
    app.get('/api/users', users.jsonlist);
    app.get('/users/:uid', users.findById);
    app.post('/users/add', users.add);
    app.post('/users/remove', users.remove);
    app.post('/users/update/:uid', users.update);
    app.get('/login', users.login);
    //  app.post('/login', passport.authenticate('local'), users.auth);
    app.post('/login', passport.authenticate('local', {failureRedirect: '/login'}), users.auth);
    app.get('/api', function (req,res) {
        var obj = {
         spam: 'test'
        }
        res.send(obj);
    });
   
   
    app.get('/qalcSelect', frontend.qalcSelect);
    app.get('/login', frontend.login);
    app.get('/myQalc', frontend.myQalc);
    app.get('/offerF', frontend.offerF);
    app.get('/qalc', frontend.qalc);

    function ensureAuthenticated(req, res, next) {
      if (req.isAuthenticated()) { return next(); }
         res.cookie('lasturl', req.path);
         res.redirect('/login');
=======
/* app.get('/', index.index);
  app.get('/admin',ensureAuthenticated , admin.main); 
*/
  
  app.get('/users/', users.list);
  app.get('/api/users', users.jsonlist);
  app.get('/users/:uid', users.findById);
  app.post('/users/add', users.add);
  app.post('/users/remove', users.remove);
  app.post('/users/update/:uid', users.update);
  app.get('/login', users.login);
//  app.post('/login', passport.authenticate('local'), users.auth);
  app.post('/login', passport.authenticate('local', {failureRedirect: '/login'}), users.auth);
  app.get('/api', function (req,res) {
    var obj = {
     spam: 'test'
>>>>>>> 321bd1bf31fb74b98cffa4195cc7700d3b6a8d1a
    }
    res.send(obj);
  });
  
/*function ensureAuthenticated(req, res, next) {
  if (req.isAuthenticated()) { return next();}
  else {res.redirect('/login')};
     res.cookie('lasturl', req.path);
     res.redirect('/login'); 
*/

function ensureAuthenticated(req, res, next) {
  if (req.isAuthenticated()) { return next(); }
     res.cookie('lasturl', req.path);
     res.redirect('/login');
}

}
